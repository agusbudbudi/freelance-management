<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AGD Dashboard - Project Progress</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Inter", sans-serif;
        background-color: #f8fafc;
        color: #1e293b;
        line-height: 1.5;
      }

      .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 32px;
      }

      .dashboard-header {
        margin-bottom: 32px;
      }

      .page-title {
        font-size: 32px;
        font-weight: 800;
        color: #0f172a;
        margin-bottom: 8px;
      }

      .page-subtitle {
        color: #64748b;
        font-size: 18px;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: white;
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border: 1px solid #f1f5f9;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
      }

      .stat-card.total::before {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      }
      .stat-card.ongoing::before {
        background: linear-gradient(135deg, #f59e0b, #d97706);
      }
      .stat-card.completed::before {
        background: linear-gradient(135deg, #10b981, #059669);
      }
      .stat-card.revenue::before {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      }

      .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
      }

      .stat-icon {
        width: 56px;
        height: 56px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
        background: linear-gradient(
          135deg,
          var(--icon-color-1),
          var(--icon-color-2)
        );
      }

      .stat-card.total .stat-icon {
        --icon-color-1: #3b82f6;
        --icon-color-2: #1d4ed8;
      }
      .stat-card.ongoing .stat-icon {
        --icon-color-1: #f59e0b;
        --icon-color-2: #d97706;
      }
      .stat-card.completed .stat-icon {
        --icon-color-1: #10b981;
        --icon-color-2: #059669;
      }
      .stat-card.revenue .stat-icon {
        --icon-color-1: #8b5cf6;
        --icon-color-2: #7c3aed;
      }

      .stat-number {
        font-size: 36px;
        font-weight: 900;
        color: #0f172a;
        margin-bottom: 8px;
        line-height: 1;
      }

      .stat-label {
        color: #64748b;
        font-size: 15px;
        font-weight: 500;
        margin-bottom: 12px;
      }

      .stat-change {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        font-weight: 500;
        padding: 4px 8px;
        border-radius: 20px;
        background: #f0fdf4;
        color: #059669;
      }

      .currency {
        color: #059669;
        font-weight: 700;
      }

      /* Chart Section */
      .chart-section {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 32px;
        margin-bottom: 40px;
      }

      .chart-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border: 1px solid #f1f5f9;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
      }

      .chart-title {
        font-size: 20px;
        font-weight: 700;
        color: #0f172a;
        margin: 0;
      }

      .chart-subtitle {
        color: #64748b;
        font-size: 14px;
        margin-top: 4px;
      }

      .chart-container {
        position: relative;
        height: 350px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .chart-legend {
        margin-top: 24px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
      }

      .legend-color.completed {
        background: linear-gradient(135deg, #10b981, #059669);
      }

      .legend-color.ongoing {
        background: linear-gradient(135deg, #f59e0b, #d97706);
      }

      .legend-text {
        font-size: 14px;
        color: #374151;
        font-weight: 500;
      }

      .legend-percentage {
        margin-left: auto;
        font-weight: 700;
        font-size: 14px;
      }

      .legend-percentage.completed {
        color: #059669;
      }

      .legend-percentage.ongoing {
        color: #d97706;
      }

      /* Recent Projects */
      .recent-projects {
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border: 1px solid #f1f5f9;
      }

      .recent-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .recent-title {
        font-size: 20px;
        font-weight: 700;
        color: #0f172a;
        margin: 0;
      }

      .view-all-btn {
        color: #3b82f6;
        text-decoration: none;
        font-weight: 500;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 8px 12px;
        border-radius: 8px;
        transition: background 0.2s ease;
      }

      .view-all-btn:hover {
        background: #f1f5f9;
      }

      .project-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .project-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        border-radius: 12px;
        transition: background 0.2s ease;
      }

      .project-item:hover {
        background: #f8fafc;
      }

      .project-avatar {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 16px;
      }

      .project-info {
        flex: 1;
      }

      .project-name {
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 4px;
      }

      .project-client {
        color: #64748b;
        font-size: 14px;
      }

      .project-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        text-transform: capitalize;
      }

      .status-progress {
        background: #dbeafe;
        color: #1d4ed8;
      }

      .status-review {
        background: #e0e7ff;
        color: #5b21b6;
      }

      .status-done {
        background: #d1fae5;
        color: #047857;
      }

      .empty-chart {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 300px;
        color: #64748b;
      }

      .empty-chart i {
        font-size: 48px;
        margin-bottom: 16px;
        color: #cbd5e1;
      }

      .empty-chart h3 {
        font-size: 18px;
        margin-bottom: 8px;
        color: #475569;
      }

      .empty-chart p {
        font-size: 14px;
      }

      @media (max-width: 1024px) {
        .chart-section {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .dashboard-container {
          padding: 16px;
        }

        .page-title {
          font-size: 24px;
        }

        .page-subtitle {
          font-size: 16px;
        }

        .stat-card {
          padding: 20px;
        }

        .chart-card {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <div class="dashboard-header">
        <h1 class="page-title">Project Dashboard</h1>
        <p class="page-subtitle">
          Track your design projects and performance metrics
        </p>
      </div>

      <!-- Stats Section -->
      <div class="stats-grid">
        <div class="stat-card total">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="total-projects">0</div>
              <div class="stat-label">Total Projects</div>
              <div class="stat-change">
                <i class="fas fa-arrow-up"></i>
                +12% from last month
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-project-diagram"></i>
            </div>
          </div>
        </div>

        <div class="stat-card ongoing">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="ongoing-projects">0</div>
              <div class="stat-label">Ongoing Projects</div>
              <div class="stat-change">
                <i class="fas fa-arrow-up"></i>
                Active work
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
          </div>
        </div>

        <div class="stat-card completed">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="completed-projects">0</div>
              <div class="stat-label">Completed Projects</div>
              <div class="stat-change">
                <i class="fas fa-check"></i>
                This month
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
          </div>
        </div>

        <div class="stat-card revenue">
          <div class="stat-header">
            <div>
              <div class="stat-number currency" id="total-revenue">Rp 0</div>
              <div class="stat-label">Total Revenue</div>
              <div class="stat-change">
                <i class="fas fa-trending-up"></i>
                All time
              </div>
            </div>
            <div class="stat-icon">
              <i class="fas fa-wallet"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart and Recent Projects Section -->
      <div class="chart-section">
        <div class="chart-card">
          <div class="chart-header">
            <div>
              <h2 class="chart-title">Project Completion Progress</h2>
              <p class="chart-subtitle">
                Overview of completed vs ongoing projects
              </p>
            </div>
          </div>

          <div class="chart-container">
            <canvas id="progressChart"></canvas>
            <div id="empty-chart" class="empty-chart" style="display: none">
              <i class="fas fa-chart-pie"></i>
              <h3>No projects yet</h3>
              <p>Add your first project to see progress analytics</p>
            </div>
          </div>

          <div class="chart-legend" id="chart-legend">
            <div class="legend-item">
              <div class="legend-color completed"></div>
              <span class="legend-text">Completed Projects</span>
              <span
                class="legend-percentage completed"
                id="completed-percentage"
                >0%</span
              >
            </div>
            <div class="legend-item">
              <div class="legend-color ongoing"></div>
              <span class="legend-text">Ongoing Projects</span>
              <span class="legend-percentage ongoing" id="ongoing-percentage"
                >0%</span
              >
            </div>
          </div>
        </div>

        <div class="recent-projects">
          <div class="recent-header">
            <h2 class="recent-title">Recent Projects</h2>
            <a href="#" class="view-all-btn">
              View all
              <i class="fas fa-arrow-right"></i>
            </a>
          </div>

          <div class="project-list" id="recent-projects-list">
            <!-- Recent projects will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let projects = JSON.parse(
        localStorage.getItem("design-projects") || "[]"
      );
      let progressChart = null;

      // Format currency
      function formatCurrency(amount) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
        }).format(amount);
      }

      // Get project avatar initials
      function getProjectInitials(projectName) {
        return projectName
          .split(" ")
          .map((word) => word.charAt(0))
          .slice(0, 2)
          .join("")
          .toUpperCase();
      }

      // Get status class
      function getStatusClass(status) {
        const statusMap = {
          "to do": "status-progress",
          "in progress": "status-progress",
          "waiting for payment": "status-review",
          "in review": "status-review",
          revision: "status-review",
          done: "status-done",
        };
        return statusMap[status] || "status-progress";
      }

      // Update dashboard statistics
      function updateDashboardStats() {
        const total = projects.length;
        const completed = projects.filter((p) => p.status === "done").length;
        const ongoing = total - completed;

        const completedRevenue = projects
          .filter((p) => p.status === "done")
          .reduce((sum, p) => sum + (p.totalPrice || 0), 0);

        const ongoingRevenue = projects
          .filter((p) => p.status !== "done")
          .reduce((sum, p) => sum + (p.totalPrice || 0), 0);

        const totalRevenue = completedRevenue + ongoingRevenue;

        // Update stat cards
        document.getElementById("total-projects").textContent = total;
        document.getElementById("ongoing-projects").textContent = ongoing;
        document.getElementById("completed-projects").textContent = completed;
        document.getElementById("total-revenue").textContent =
          formatCurrency(totalRevenue);

        return { total, completed, ongoing, completedRevenue, ongoingRevenue };
      }

      // Create progress pie chart
      function createProgressChart(completed, ongoing) {
        const ctx = document.getElementById("progressChart").getContext("2d");
        const total = completed + ongoing;

        // Destroy existing chart if it exists
        if (progressChart) {
          progressChart.destroy();
        }

        if (total === 0) {
          document.getElementById("progressChart").style.display = "none";
          document.getElementById("empty-chart").style.display = "flex";
          document.getElementById("chart-legend").style.display = "none";
          return;
        }

        document.getElementById("progressChart").style.display = "block";
        document.getElementById("empty-chart").style.display = "none";
        document.getElementById("chart-legend").style.display = "block";

        const completedPercentage = ((completed / total) * 100).toFixed(1);
        const ongoingPercentage = ((ongoing / total) * 100).toFixed(1);

        // Update legend percentages
        document.getElementById("completed-percentage").textContent =
          completedPercentage + "%";
        document.getElementById("ongoing-percentage").textContent =
          ongoingPercentage + "%";

        progressChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Completed Projects", "Ongoing Projects"],
            datasets: [
              {
                data: [completed, ongoing],
                backgroundColor: [
                  "rgba(16, 185, 129, 0.8)",
                  "rgba(245, 158, 11, 0.8)",
                ],
                borderColor: ["rgba(5, 150, 105, 1)", "rgba(217, 119, 6, 1)"],
                borderWidth: 3,
                hoverBackgroundColor: [
                  "rgba(16, 185, 129, 1)",
                  "rgba(245, 158, 11, 1)",
                ],
                cutout: "65%",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "white",
                bodyColor: "white",
                borderColor: "rgba(255, 255, 255, 0.1)",
                borderWidth: 1,
                callbacks: {
                  label: function (context) {
                    const label = context.label || "";
                    const value = context.parsed;
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ${value} projects (${percentage}%)`;
                  },
                },
              },
            },
            animation: {
              animateScale: true,
              animateRotate: true,
              duration: 1000,
            },
          },
        });
      }

      // Update recent projects
      function updateRecentProjects() {
        const recentProjectsList = document.getElementById(
          "recent-projects-list"
        );

        if (projects.length === 0) {
          recentProjectsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #64748b;">
                        <i class="fas fa-folder-open" style="font-size: 32px; margin-bottom: 12px; color: #cbd5e1;"></i>
                        <p>No projects yet</p>
                    </div>
                `;
          return;
        }

        // Get the 5 most recent projects
        const recentProjects = projects
          .sort(
            (a, b) =>
              new Date(b.createdAt || b.updatedAt) -
              new Date(a.createdAt || a.updatedAt)
          )
          .slice(0, 5);

        recentProjectsList.innerHTML = recentProjects
          .map(
            (project) => `
                <div class="project-item">
                    <div class="project-avatar">
                        ${getProjectInitials(project.projectName)}
                    </div>
                    <div class="project-info">
                        <div class="project-name">${project.projectName}</div>
                        <div class="project-client">${project.clientName}</div>
                    </div>
                    <div class="project-status ${getStatusClass(
                      project.status
                    )}">
                        ${project.status}
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Initialize dashboard
      function initDashboard() {
        const stats = updateDashboardStats();
        createProgressChart(stats.completed, stats.ongoing);
        updateRecentProjects();
      }

      // Listen for storage changes (when projects are updated from other pages)
      window.addEventListener("storage", function (e) {
        if (e.key === "design-projects") {
          projects = JSON.parse(e.newValue || "[]");
          initDashboard();
        }
      });

      // Auto-refresh every 30 seconds
      setInterval(() => {
        projects = JSON.parse(localStorage.getItem("design-projects") || "[]");
        initDashboard();
      }, 30000);

      // Initialize on load
      document.addEventListener("DOMContentLoaded", initDashboard);
    </script>
  </body>
</html>
